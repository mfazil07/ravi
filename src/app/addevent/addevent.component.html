<div *ngIf="!loading" >
  <div class="title flex m-t">
    <div cds-text="subsection"><cds-icon shape="folder-open" solid="true"></cds-icon> Weather Notification Search</div>
  </div>
  
  <form clrForm clrLayout="horizontal" #weathersearchform="ngForm" (ngSubmit)="onSubmit(weathersearchform)">
      <div class="clr-row">
          <!-- Location field -->
          <div class="clr-col-12 clr-col-md-3">
            <clr-input-container>
              <label for="location" class="clr-col-12 clr-col-md-2"><div>Location</div></label>
              <input class="clr-col-12 clr-col-md-8 narrow-select" clrInput type="text" id="location"  name="location" #frmSrchLocation="ngModel" [(ngModel)]="weathersearch.frmSrchLocation" />
            </clr-input-container>     
          </div>
  
          <!-- Weather Type field -->
          <div  class="clr-col-12 clr-col-md-3">
              <clr-select-container>
                <label for="weatherType" class="clr-col-12 clr-col-md-4">Weather&nbsp;Type</label>
                    <select class="clr-col-12 clr-col-md-8 narrow-select2" clrSelect id="weatherType" name="weatherTypenm"[(ngModel)]="weathersearch.weatherTypenm" #weatherTypenm="ngModel">
                      <option value="">ALL</option>
                      <option *ngFor="let item of weatherTypes" [value]="item.key">{{ item.value }}</option>
                    </select>
              </clr-select-container>
          </div>
         
         <!-- Start Date field -->        
         <div class="clr-col-12 clr-col-md-3 ">
          <clr-date-container [ngClass]="{'clr-error': startDateError && frmSrchStDt.touched}">
              <label for="startDatepickrnm" class="clr-col-12 clr-col-md-3">Start&nbsp;Date</label>
              <input class="clr-col-12 clr-col-md-9" type="date" required  clrDate id="startDatepickrnm" name="startDatepickrnm"#frmSrchStDt="ngModel" 
                [(ngModel)]="weathersearch.frmSrchStDt"
                (ngModelChange)="checkDates()">                
          </clr-date-container>
          <clr-control-error *ngIf="startDateError">
            {{startDateErrorMsgs}}
          </clr-control-error>
        </div>
  
        <!-- End Date field -->
        <div class="clr-col-12 clr-col-md-3">
          <clr-date-container [ngClass]="{'clr-error': endDateError  && frmSrchEndDt.touched}">
              <label for="endDatepickrnm" class="clr-col-12 clr-col-md-3">End&nbsp;Date</label>
              <input class="clr-col-12 clr-col-md-9" type="date" required clrDate id="endDatepickrnm" name="endDatepickrnm" #frmSrchEndDt="ngModel" 
                [(ngModel)]="weathersearch.frmSrchEndDt"
                (ngModelChange)="checkDates()">           
          </clr-date-container>
          <clr-control-error *ngIf="endDateError">
           {{endDateErrorMsgs}}
          </clr-control-error>
        </div>
      </div>
  
      <div class="clr-row">
        <!-- Country field -->
        <div class="clr-col-12 clr-col-md-3">
          <clr-combobox-container>
            <label for="frmSrchCountry" class="clr-col-12 clr-col-md-2">Country</label>
            <clr-combobox class="clr-col-12 clr-col-md-8 narrow-select" [(ngModel)]="weathersearch.frmSrchCountry" clrMulti="true"
              name="frmSrchCountry"  #frmSrchCountry="ngModel" (ngModelChange)="countryChanged()">
              <ng-container *clrOptionSelected="let selected">
                {{ selected?.value }}
              </ng-container>
              <clr-options>
                <clr-option *clrOptionItems="let country of getAvailableCountries(); field: 'value'" [clrValue]="country">
                  {{ country.value }}
                </clr-option>
              </clr-options>
            </clr-combobox>              
          </clr-combobox-container>               
        </div>
  
      <!-- State Dropdown (Visible if USA is selected for Country) -->
      <div  class="clr-col-12 clr-col-md-3" *ngIf="isUSAExist">           
          <clr-combobox-container>
            <label for="frmState" class="clr-col-12 clr-col-md-4">States <span class="us-state-text-font">(US only)</span></label>
            <clr-combobox class="clr-col-12 clr-col-md-3 narrow-select2"  [(ngModel)]="weathersearch.frmSrchState" (clrSelectionChange)="clearSearch($event)" 
            [placeholder]="weathersearch?.frmSrchState?.length > 0 ?'' :'ALL'" 
            clrMulti="true" name="frmSrchState" #frmSrchState="ngModel">
              <ng-container *clrOptionSelected="let selected">
                {{ selected?.value }}
              </ng-container>
              <clr-options>
                <clr-option *clrOptionItems="let state of states; field:'value'" [clrValue]="state">
                  {{ state.key }}
                </clr-option>
              </clr-options>
            </clr-combobox>                
          </clr-combobox-container>    
      </div>
  
          <!-- Check box field -->
          <div class="clr-col-12 clr-col-md-2">
            <div class="checkbox-container">
              <input type="checkbox" clrCheckbox id="activeBox" name="activeBox" [(ngModel)]="weathersearch.frmActiveBox" #frmActiveBox="ngModel">
              <label for="frmActiveBox" class="activelabel">Active</label>
            </div>
          </div> 
          <div class="clr-col-12 clr-col-md-3"></div>
      </div>
      <!-- Button section -->
      <div class="clr-row">
        <div class="clr-col-12 clr-col-md-9"></div>
          <div class="clr-col-12 clr-col-md-3.5">
            <button type="button" class="btn btn-primary button-float-right" (click)="reset(weathersearchform)">
                <cds-icon shape="sync"></cds-icon>Reset</button>
            <button type="submit" class="btn btn-primary button-float-right" [disabled]="!enableSearch ? !enableSearch : !weathersearchform.valid">
                <cds-icon shape="search"></cds-icon>Search</button>
            <button type="button" class="btn btn-primary button-float-right" (click)="openModal('add')">
                <cds-icon shape="plus"></cds-icon>Add New Event</button>            
          </div>
        </div>
   </form>
  
  <!-- Grid Section -->
  <div  class="clr-row">
    <div class="clr-col-12">
      <clr-datagrid> 
        <clr-dg-column [clrDgField]="'alertName'">
          <ng-container *clrDgHideableColumn>Weather Event</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'alertType'">
          <ng-container *clrDgHideableColumn>Weather Type</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'description'" >
          <ng-container *clrDgHideableColumn>Description</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'location'">
          <ng-container *clrDgHideableColumn>Location</ng-container>
        </clr-dg-column> 
        <clr-dg-column [clrDgField]="'countryCode'">
          <ng-container *clrDgHideableColumn>Country</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'stateList'">
          <ng-container *clrDgHideableColumn>States (US only)</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'startDate'">
          <ng-container *clrDgHideableColumn>Event Start Date</ng-container>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'endDate'">
          <ng-container *clrDgHideableColumn>Event End Date</ng-container>
        </clr-dg-column>        
        <clr-dg-column [clrDgField]="'activeStatus'" >
          <ng-container *clrDgHideableColumn>Event Expiry Status</ng-container>
        </clr-dg-column>
        <clr-dg-column>Action</clr-dg-column>      
        
        <!-- placeholder if there is no weather events-->
        <clr-dg-placeholder *ngIf="!weatherEvents || weatherEvents.length === 0">
               No Weather Events found!
        </clr-dg-placeholder>
  
        <clr-dg-row *clrDgItems="let weather of weatherEvents">              
          <clr-dg-cell>
            <span class="break-word">{{ weather?.alertName }}</span>
          </clr-dg-cell>
          <clr-dg-cell>{{ weather?.alertType}}</clr-dg-cell>
          <clr-dg-cell><div class="break-word">{{ weather?.description}}</div></clr-dg-cell>
          <clr-dg-cell>
            <span class="break-word">{{ weather?.location }}</span>
          </clr-dg-cell>
          <clr-dg-cell>{{ weather?.countryCode }}</clr-dg-cell>
          <clr-dg-cell>
            <span class="break-word">{{ weather?.stateList }}</span>
          </clr-dg-cell>
          <clr-dg-cell>{{ weather?.startDate | date: 'MM/dd/yyyy' }}</clr-dg-cell>
          <clr-dg-cell>{{ weather?.endDate | date: 'MM/dd/yyyy' }}</clr-dg-cell>          
          <clr-dg-cell>{{ weather?.activeStatus }}</clr-dg-cell>
          <clr-dg-cell>
            <div class="button-wrapper">
              <span class="cellContainer" (click)="editEntry(weather)">
                 <cds-icon shape="pencil" solid="true"></cds-icon>
              </span>
              <span class="cellContainer" (click)="onDelete(weather)" [class.disabled]="checkIsActiveWeatherEvent(weather)">
                  <cds-icon shape="trash" solid="true" class="cur-ptr trash-color"></cds-icon>
              </span>                  
            </div>
          </clr-dg-cell>
        </clr-dg-row>
  
        <!-- footer section-->
        <clr-dg-footer>
          <clr-dg-pagination #pagination>
            <clr-dg-page-size [clrPageSizeOptions]="[10, 20, 50, 100]">weather alerts per page</clr-dg-page-size>
              {{ pagination.firstItem + 1 }} - {{ pagination.lastItem + 1 }} of {{ pagination.totalItems }} weather alerts
          </clr-dg-pagination>
        </clr-dg-footer>
      </clr-datagrid>
    </div>
  </div>
  <app-addevent [formData]="gridData" (closeEvent)="handleFormClose($event)" />
  </div>
