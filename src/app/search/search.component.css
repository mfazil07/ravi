function toggleWeatherAlerts() {
    var requestedByText = $("#ddlRequestedBy option:selected").text();
    var rescheduleReasonText = $("#ddlRescheduleReason option:selected").text();

    if (requestedByText === "EXAMINEE" && rescheduleReasonText === "Appointment rescheduled per weather event") {
        $("#weatherAlertsSection").show();

        // Restore previously selected values
        $('#@idDDCountry').val(selectedCountriesFromModel).trigger("change");
        $('#ddlRescheduleApptState').val(selectedStatesFromModel).trigger("change");

        // Optional: refresh multiselect plugin if you're using it
        if ($('#@idDDCountry').data('multiselect')) {
            $('#@idDDCountry').multiselect('refresh');
            $('#ddlRescheduleApptState').multiselect('refresh');
        }

    } else {
        $("#weatherAlertsSection").hide();

        // Clear dropdown selections
        $('#@idDDCountry').val(null).trigger("change");
        $('#ddlRescheduleApptState').val(null).trigger("change");
        $('#ddlRescheduleWeatherEvent').val("").trigger("change");

        // Optional: refresh multiselect plugin
        if ($('#@idDDCountry').data('multiselect')) {
            $('#@idDDCountry').multiselect('refresh');
            $('#ddlRescheduleApptState').multiselect('refresh');
        }
    }
}


////////////////////////////

function callGetWeatherEvents() {
    const selectedCountries = $('#@idDDCountry').val() || [];
    const selectedStates = $('#ddlRescheduleApptState').val() || [];

    const hasUSA = selectedCountries.includes("USA");
    const hasOtherCountries = selectedCountries.some(c => c !== "USA");

    // RULE: Call only if (hasOtherCountries) OR (hasUSA AND states selected)
    if (!hasOtherCountries && (!hasUSA || selectedStates.length === 0)) {
        updateWeatherEventsDropdown([]); // Clear weather event dropdown
        return;
    }

    $.ajax({
        url: '@Url.Action("GetWeatherEvents", "YourControllerName")', // Replace with your controller
        method: 'POST',
        data: {
            countries: selectedCountries,
            states: selectedStates
        },
        traditional: true,
        success: function (response) {
            updateWeatherEventsDropdown(response);
        },
        error: function () {
            console.error('Error fetching weather events.');
            updateWeatherEventsDropdown([]); // Optionally clear
        }
    });
}

/// hoook

$(document).ready(function () {
    var selectedCountriesFromModel = @Html.Raw(Json.Serialize(Model.Country ?? new List<string>()));
    $('#@idDDCountry').val(selectedCountriesFromModel).trigger("change");

    var selectedStatesFromModel = @Html.Raw(Json.Serialize(Model.State ?? new List<string>()));
    $('#ddlRescheduleApptState').val(selectedStatesFromModel).trigger("change");

    if ($('#@idDDCountry').data('multiselect')) {
        $('#@idDDCountry').multiselect('refresh');
        $('#ddlRescheduleApptState').multiselect('refresh');
    }

    // Trigger once on page load
    callGetWeatherEvents();

    // Bind to changes
    $('#@idDDCountry, #ddlRescheduleApptState').on('change', function () {
        callGetWeatherEvents();
    });
});
