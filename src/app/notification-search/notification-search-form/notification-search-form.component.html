describe('NotificationSearchFormComponent - countryStateChange', () => {
  let component: NotificationSearchFormComponent;
  let fixture: ComponentFixture<NotificationSearchFormComponent>;
  let mockClaimantsWeatherAlertsService: any;

  beforeEach(async () => {
    mockClaimantsWeatherAlertsService = {
      getClaimantInfo: jasmine.createSpy('getClaimantInfo').and.returnValue(
        of({
          country: 'USA',
          state: 'CA',
          mappedCountries: ['USA', 'CAN'],
          mappedStates: ['CA', 'TX'],
        })
      ),
    };

    await TestBed.configureTestingModule({
      declarations: [NotificationSearchFormComponent],
      imports: [ClarityModule, FormsModule, HttpClientModule],
      schemas: [NO_ERRORS_SCHEMA],
      providers: [
        {
          provide: 'ClaimantsWeatherAlertsService',
          useValue: mockClaimantsWeatherAlertsService,
        },
        {
          provide: CommonService,
          useClass: MockCommonService, // Mock CommonService
        },
      ],
    }).compileComponents();

    fixture = TestBed.createComponent(NotificationSearchFormComponent);
    component = fixture.componentInstance;

    // Set up initial state for the component
    component.claimantId = 123;
    component.caseId = 456;
    component.notificationSearch = {
      mappedEvents: false,
      frmSrchCountry: [],
      frmSrchState: [],
    };
    component.countries = [
      { key: 'USA', value: 'United States' },
      { key: 'CAN', value: 'Canada' },
    ];
  });

  it('should call getClaimantInfo with correct parameters', () => {
    component.countryStateChange();
    expect(mockClaimantsWeatherAlertsService.getClaimantInfo).toHaveBeenCalledWith(
      123,
      456,
      false
    );
  });

  it('should update caseDetails with the response data', () => {
    component.countryStateChange();
    expect(component.caseDetails).toEqual({
      country: 'USA',
      state: 'CA',
      mappedCountries: ['USA', 'CAN'],
      mappedStates: ['CA', 'TX'],
    });
  });

  it('should handle error response', () => {
    const errorResponse = new HttpErrorResponse({
      error: 'test 404 error',
      status: 404,
      statusText: 'Not Found',
    });

    mockClaimantsWeatherAlertsService.getClaimantInfo.and.returnValue(
      throwError(() => errorResponse)
    );

    spyOn(component, 'handleError');
    component.countryStateChange();

    expect(component.handleError).toHaveBeenCalledWith(errorResponse);
  });
});
